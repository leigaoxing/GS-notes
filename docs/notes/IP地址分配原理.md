# 1. 网络模型介绍

在计算机网络中有著名的OSI (Open System Interconnection，[开放式系统互联](https://baike.baidu.com/item/开放式系统互联/562749)) 七层协议系统结构，概念清除，理论完整，三十它既复杂又不实用。TCP/IP体系结构则不同，得到广泛的应用。最终结合 OSI 和 TCP/IP 的优点，采用了一种只有五层协议的体系结构。本文讲述的 IP 都是基于五层协议模型中的网络层。

<table border="0" cellpadding="0" cellspacing="0" width="336">
 <colgroup><col width="104">
 <col width="126">
 <col width="106">
 </colgroup><tbody><tr height="19" id="r0">
<td height="19" class="x21" width="104">OSI体系结构</td>
<td class="x21" width="126">TCP/IP体系结构</td>
<td class="x21" width="106">五层体系结构</td>
 </tr>
 <tr height="19" id="r1">
<td height="19" class="x21"></td>
<td class="x21"></td>
<td class="x21"></td>
 </tr>
 <tr height="19" id="r2">
<td height="19" class="x21">7 应用层</td>
<td rowspan="3" height="57" class="x22">应用层</td>
<td rowspan="3" height="57" class="x22">5 应用层</td>
 </tr>
 <tr height="19" id="r3">
<td height="19" class="x21">6 表示层</td>
 </tr>
 <tr height="19" id="r4">
<td height="19" class="x21">5 会话层</td>
 </tr>
 <tr height="19" id="r5">
<td height="19" class="x21">4 传输层</td>
<td class="x21">传输层</td>
<td class="x21">4 传输层</td>
 </tr>
 <tr height="19" id="r6">
<td height="19" class="x21">3 网络层 </td>
<td class="x21">网络层</td>
<td class="x21">3 网络层</td>
 </tr>
 <tr height="19" id="r7">
<td height="19" class="x21">2 数据链路层</td>
<td rowspan="2" height="38" class="x22">网络接口层</td>
<td class="x21">2 数据链路层</td>
 </tr>
 <tr height="19" id="r8">
<td height="19" class="x21">1 物理层</td>
<td class="x21">1 物理层</td>
 </tr>
</tbody></table>

# 2. 分类的IP地址

## 2.1 IP 地址的表示方法

IP 地址就是给因特网上的每个主机（路由器）的每个界都分配一个在全世界范围是唯一的 32 位标识符。其组成第一个字段是网络号，第二个字段是主机号。一个主机号在前面的网络号所指明的网络范围内必须是唯一的，所以一个 IP 地址在整个网络中都是唯一的。目前分为 A、B、C、D、E五类 IP 地址。

![](pics\IP地址分类.png)

在A、B、C 三类地址中灰色的部分即为网络号，网络号的前三位是类别类，分别是 0、10、110 。也就是说我们可以凭借这个类别位置来辨别网络类型。

32位的总长度，由于 A、B、C 三类网括号的长度的不同，导致 A、B、C 类在地址的主机号字段的字节数分别为 3、2、1。（一字节8位）。

D 类地址的网络号为 1110，用于多播（一对多通讯）。E 类地址的网络号为 1111，保留了以后使用。

因此，我们一般使用 A、B、C 三类网络地址，IP 地址是 32 位的二进制代码，为了提高可读性，把 32 位的 IP 地址中的每 8 位用等效的 十进制表示出来（点分十进制），于是，我们日常生活中常见的 IP 地址就出现了。例如：IP 地址，128.11.3.31，转化为二进制为 10000000 00001011 00000011 00011111 ，可以看出类别位为 10，可以判断为一个B类地址。

## 2.2 网络号的指派范围

A 类地址网络号占用一个字节，但是由于有一位是类别位，只有 7 位可供使用，但是由于规定，网络字段全 0 是个保留字段表示本网络，而 127（01111111）是另外一个保留字段，作为本地软件的环回测试。我们常见的 127.0.0.1 表示本机，原因也是出自这里。所以 A 类地址可以指派的网络号个数为（2^7-2）.

B 类网络地址网络号 2 个字节，前两位为 10 已经固定，只剩下 14 位可用，有这 14 位无论怎么取值都不会使得网络信号全为 0 或者全为 1 ，但实际上规定，规定 B 类最小网络地址为 128.1.0.0 。因此，B 类地址可指派的网络号个数（2^14 - 1）。

C 类地址有 3 个字节的网络号，前三位固定 110，只剩下 21 位可用，同样 C 类地址可能指派的最小网络地址是 192.0.1.0，因此 C 类地址可指派的网络号个数为（2^21 - 1）。

## 2.3  主机号指派范围

由于主机号有规定，全 0 的主机号代表 IP 地址是“本主机”所连接到的单个网络地址，（例如：一个主机地址为 5.6.7.8，则该主机所在的网络地址为 5.0.0.0），而全1 表示“所有的”，即表示该网络上的所有主机。

A 类地址的主机号由三个字节，即24位组成，所以每个 A 类的网络中可分配的主机个数为（2^24 - 2）。

B 类地址的主机号是两个字节，即16位组成，所以每一个 B 类网络中可分配的主机个数为（2^16 - 2）。

C 类地址的主机号是一个字节，即 8 位组成，所以每一个 C 类网络中可分配的主机个数为（2^8 - 2）。

## 总结 IP 指派范围

综上网络号和主机号的指派描述可知，IP地址空间共有232个地址。 

所有A类地址共有（27-2）\*（224-2）个，大约231，占50%； 
所有B类地址共有（214-1）\*（216-2）个，大约230，占25%； 
所有C类地址共有（221-1）\*（28-2）个，大约229，占12.5%；

| 网络类别 | 最大可分配网络数 | 首个可分配网络号 | 最后一个可分配网络号 | 每个网络中最大主机数 |
| -------- | ---------------- | ---------------- | -------------------- | -------------------- |
| A        | 126 (27-2)       | 1                | 126                  | 16777214             |
| B        | 16383 (214-1)    | 128.1            | 191.255              | 65534                |
| C        | 2097151 (221-1)  | 192.0.1          | 223.255.255          | 254                  |

可以这样来表示一个A类IP地址 n.x.y.z，若1≤n≤126，0≤x,y,z≤255，其中 x,y,z不同时为0也不能同时为255.

可以这样来表示一个B类IP地址 n.m.x.y，若128≤n≤191，0≤m≤255，0≤x,y≤255，其中 I. 当n=128时，m≠0; II. x,y不同时为0也不能同时为255;

可以这样来表示一个C类IP地址 n.m.k.x，若192≤n≤223，0≤m,k≤255，1≤x≤254，其中 当n=192时，k≠0.

# 3. IP 地址和硬件地址

从层次角度来看，硬件地址是**数据链路层**和**物理层**使用的地址（常称作 MAC 地址），而 IP 地址是**网络层**和**以上各层**使用的地址，是一种逻辑地址。在网络层我们进行数据报文从 IP1 传输到 IP2 ，无论我们中间经过多少次转发，从网络层来看，源地址始终是 IP1 ，目的地址始终是 IP2 。但是从数据链路层来看，显然就不是这样了，这些是物理地址，很可能从源地址经过多次中间节点的物理地址的转发才能到达目的节点。

而 IP 地址和物理地址之间的转化要依靠两个重要的协议 ARP（地址解析协议），RARP（逆地址解析协议）。IP 地址通过 ARP 转化成物理地址，物理地址通过 RARP 转化为相应的 IP 地址。

# 4. 子网和超网

简单来说，就是如何来管理一个 IP 地址下的多台主机。

## 4.1 子网

现在假设这样一个场景，一个数据目的地址是 145.13.3.10（在子网 145.13.3.0中），已经到达路由器 R1 1(45.13.0.0)，那么这个路由器怎么才能将它转发到 145.13.3.0 呢？

我们并不知道目的地址是否进行了子网划分。

这就引出了子网掩码的概念了，子网掩码也是 32 位，由一串 1 和 0 组成，子网掩码中的 1 对应于 IP 地址中的网络号位置 和 子网网络号位置，子网掩码中的 0 对应于 IP 地址中出现主机号位置。

- A类地址的默认子网掩码是255.0.0.0
- B类地址的默认子网掩码是255.255.0.0
- C类地址的默认子网掩码是255.255.255.0

我们只要将 IP 地址 和 子网掩码 进行 “与”运算，如果进行了子网的划分，就立刻得出要找的子网的网络地址，如果没有进行子网划分（有默认的子网掩码），则直接能够得出该 IP 地址的网路地址来。

![](pics\IP地址和子网掩码做与运算计算所在网段.jpg)

## 4.2 超网

无分类编址 CIDR，使用变长的子网掩码，可以进一步提高 IP 地址的资源利用率。有两个特点 
**第一**，消除了传统的 ABC 类地址及划分子网的概念，CIRD 把32位的IP 地址划分成为两个部分，网络前缀和剩下的部分，表示方法为，在IP地址后面加上“/”，然后写上网络前缀所占位数。 
**第二**，把网络前缀相同的IP地址组成一个CIDR地址块，例如，IP地址 128.14.35.7/20 用二进制表示 100000000 00001110 00100011 00000111，所以我们很容易可以得出这块地址中最小地址为128.14.32.0,即 100000000 00001110 00100000 00000000，最大地址为128.14.47.255，即 100000000 00001110 00101111 11111111.

为了更加方便进行路由选择，CIDR使用32位的地址掩码，1的个数就是网络前缀的长度，如上面所举例中的/20的地址块的地址掩码是 11111111 11111111 11110000 00000000

因此可以看出，网络前缀越短，其地址块所包含的地址就越多，这样可以根据实际情况更加有效的分配 IPv4 的地址空间。而由很多个CIDR 地址快构成的庞大的网络就就被称为“超网”。

# 参考：

[IP 地址分配原理](https://blog.csdn.net/qzcsu/article/details/72859431)

[什么是子网？什么是子网掩码？](http://www.360doc.com/content/18/0921/19/37113458_788584404.shtml)

[Web开发应该知道的计算机网络知识 ](http://www.sohu.com/a/212580829_465223)

